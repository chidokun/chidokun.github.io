<!doctype html><html lang=vi>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.87.0 with theme Tranquilpeak 0.4.8-BETA">
<meta name=author content="Nguyễn Tuấn">
<meta name=keywords content="shopee code league,order brushing,development,programming,chidokun,lập trình">
<meta name=description content="Shopee Code League là một thử thách lập trình trực tuyến kéo dài 02 tháng bao gồm một loạt các cuộc thi, câu hỏi về thuật toán trực tuyến và hội thảo đào tạo trực tuyến dành cho tất cả sinh viên và các chuyên gia trên toàn khu vực (xem thêm tại Shopee Code League 2020). Challenge đầu tiên vừa diễn ra là Order Brushing Problem (Chủ đề Data Analytics). Mình cùng teammate vừa hoàn thành xong challenge này, dù chưa xây dựng được giải pháp tối ưu nhất (score: 0,98/1,0) nhưng cũng giới thiệu đến các bạn giải pháp của nhóm trong bài toán này.">
<meta property="og:description" content="Shopee Code League là một thử thách lập trình trực tuyến kéo dài 02 tháng bao gồm một loạt các cuộc thi, câu hỏi về thuật toán trực tuyến và hội thảo đào tạo trực tuyến dành cho tất cả sinh viên và các chuyên gia trên toàn khu vực (xem thêm tại Shopee Code League 2020). Challenge đầu tiên vừa diễn ra là Order Brushing Problem (Chủ đề Data Analytics). Mình cùng teammate vừa hoàn thành xong challenge này, dù chưa xây dựng được giải pháp tối ưu nhất (score: 0,98/1,0) nhưng cũng giới thiệu đến các bạn giải pháp của nhóm trong bài toán này.">
<meta property="og:type" content="article">
<meta property="og:title" content="Order Brushing Problem (Shopee Code League 2020)">
<meta name=twitter:title content="Order Brushing Problem (Shopee Code League 2020)">
<meta property="og:url" content="https://chidokun.github.io/2020/06/order-brushing/">
<meta property="twitter:url" content="https://chidokun.github.io/2020/06/order-brushing/">
<meta property="og:site_name" content="Nguyễn Tuấn's Blog">
<meta property="og:description" content="Shopee Code League là một thử thách lập trình trực tuyến kéo dài 02 tháng bao gồm một loạt các cuộc thi, câu hỏi về thuật toán trực tuyến và hội thảo đào tạo trực tuyến dành cho tất cả sinh viên và các chuyên gia trên toàn khu vực (xem thêm tại Shopee Code League 2020). Challenge đầu tiên vừa diễn ra là Order Brushing Problem (Chủ đề Data Analytics). Mình cùng teammate vừa hoàn thành xong challenge này, dù chưa xây dựng được giải pháp tối ưu nhất (score: 0,98/1,0) nhưng cũng giới thiệu đến các bạn giải pháp của nhóm trong bài toán này.">
<meta name=twitter:description content="Shopee Code League là một thử thách lập trình trực tuyến kéo dài 02 tháng bao gồm một loạt các cuộc thi, câu hỏi về thuật toán trực tuyến và hội thảo đào tạo trực tuyến dành cho tất cả sinh viên và các chuyên gia trên toàn khu vực (xem thêm tại Shopee Code League 2020). Challenge đầu tiên vừa diễn ra là Order Brushing Problem (Chủ đề Data Analytics). Mình cùng teammate vừa hoàn thành xong challenge này, dù chưa xây dựng được giải pháp tối ưu nhất (score: 0,98/1,0) nhưng cũng giới thiệu đến các bạn giải pháp của nhóm trong bài toán này.">
<meta property="og:locale" content="vi">
<meta property="article:published_time" content="2020-06-14T17:05:24">
<meta property="article:modified_time" content="2020-06-14T17:05:24">
<meta property="article:section" content="analysis">
<meta property="article:tag" content="data">
<meta property="article:tag" content="python">
<meta property="article:tag" content="programming">
<meta name=twitter:card content="summary">
<meta property="fb:app_id" content="445006706177461">
<meta property="og:image" content="https://chidokun.github.io/thumbnails/shopee-code-league.jpg">
<meta property="twitter:image" content="https://chidokun.github.io/thumbnails/shopee-code-league.jpg">
<meta property="og:image" content="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=640">
<meta property="twitter:image" content="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=640">
<title>Order Brushing Problem (Shopee Code League 2020)</title>
<meta name=google-site-verification content="MgXdDXZwDhcwwTzczA6YhQBynidGFAQUBd7PKu2ubfI">
<link rel=icon href=https://chidokun.github.io/favicon.png>
<link rel=canonical href=https://chidokun.github.io/2020/06/order-brushing/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin=anonymous>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,700|Roboto+Mono&display=swap&subset=vietnamese" rel=stylesheet>
<link rel=stylesheet href=https://chidokun.github.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css>
<link rel=stylesheet crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css integrity=sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-64965138-2','auto'),ga('send','pageview'))</script>
</head>
<body>
<div id=blog>
<header id=header data-behavior=5>
<i id=btn-open-sidebar class="fa fa-lg fa-bars"></i>
<div class=header-title>
<a class=header-title-link href=https://chidokun.github.io/>Nguyễn Tuấn's Blog</a>
</div>
<a class="header-right-icon st-search-show-outputs" href=https://chidokun.github.io/#search>
<i class="fa fa-lg fa-search"></i>
</a>
</header>
<nav id=sidebar data-behavior=5>
<div class=sidebar-container>
<div class=sidebar-profile>
<a href=https://chidokun.github.io/#about>
<img class=sidebar-profile-picture src="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=110" alt="Ảnh đại diện">
</a>
<h4 class=sidebar-profile-name>Nguyễn Tuấn</h4>
<h5 class=sidebar-profile-bio>A guy with passionate at the code</h5>
</div>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/>
<i class="sidebar-button-icon fa fa-lg fa-home"></i>
<span class=sidebar-button-desc>Trang chủ</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/categories>
<i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
<span class=sidebar-button-desc>Danh mục</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/tags>
<i class="sidebar-button-icon fa fa-lg fa-tags"></i>
<span class=sidebar-button-desc>Thẻ thông tin</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/archives>
<i class="sidebar-button-icon fa fa-lg fa-archive"></i>
<span class=sidebar-button-desc>Lưu trữ</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/#about>
<i class="sidebar-button-icon fa fa-lg fa-question"></i>
<span class=sidebar-button-desc>Thông tin</span>
</a>
</li>
</ul>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://github.com/chidokun target=_blank rel=noopener>
<i class="sidebar-button-icon fa fa-lg fa-github"></i>
<span class=sidebar-button-desc>GitHub</span>
</a>
</li>
</ul>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://chidokun.github.io/index.xml>
<i class="sidebar-button-icon fa fa-lg fa-rss"></i>
<span class=sidebar-button-desc>RSS</span>
</a>
</li>
</ul>
</div>
</nav>
<div id=main data-behavior=5 class=hasCoverMetaIn>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<div class="post-header main-content-wrap text-left">
<h1 class=post-title itemprop=headline>
Order Brushing Problem (Shopee Code League 2020)
</h1>
<div class="postShorten-meta post-meta">
<time itemprop=datePublished datetime=2020-06-14T17:05:24+07:00>
14 tháng 6 2020
</time>
<span>mục</span>
<a class=category-link href=https://chidokun.github.io/categories/analysis>analysis</a>
</div>
<div>
<div class=fb-like data-href=https://chidokun.github.io/2020/06/order-brushing/ data-width data-layout=button_count data-action=like data-size=large data-share=false></div>
</div>
</div>
<div class="post-content markdown" itemprop=articleBody>
<div class=main-content-wrap>
<p><strong>Shopee Code League</strong> là một thử thách lập trình trực tuyến kéo dài 02 tháng bao gồm một loạt các cuộc thi, câu hỏi về thuật toán trực tuyến và hội thảo đào tạo trực tuyến dành cho tất cả sinh viên và các chuyên gia trên toàn khu vực (xem thêm tại <a href=https://careers.shopee.sg/codeleague/>Shopee Code League 2020</a>). Challenge đầu tiên vừa diễn ra là <strong>Order Brushing Problem</strong> (Chủ đề Data Analytics). Mình cùng teammate vừa hoàn thành xong challenge này, dù chưa xây dựng được giải pháp tối ưu nhất (score: 0,98/1,0) nhưng cũng giới thiệu đến các bạn giải pháp của nhóm trong bài toán này.</p>
<h1 id=1-quan-sát-dữ-liệu>1. Quan sát dữ liệu</h1>
<p>Team mình tham gia hạng mục <strong>Open</strong> nên mình chỉ bàn về đề bài ở hạng mục này.</p>
<p>Có thể xem đề bài và mô tả dữ liệu trên Kaggle: <a href=https://www.kaggle.com/c/order-brushing-shopee-code-league>[Open] Shopee Code League - Order Brushing</a></p>
<div class="figure center">
<a class=fancybox href=https://chidokun.github.io/images/post/order-brushing/1.png title="Dữ liệu được public trên Kaggle" data-fancybox-group>
<img class=fig-img src=https://chidokun.github.io/images/post/order-brushing/1.png style=width:100% alt="Dữ liệu được public trên Kaggle">
</a>
<span class=caption>Dữ liệu được public trên Kaggle</span>
</div>
<p>Dữ liệu có 222.750 dòng x 4 cột:</p>
<ul>
<li><strong>orderid</strong>: Mã đơn hàng, duy nhất trên toàn bộ dữ liệu.</li>
<li><strong>shopid</strong>: Mã shop, là một người bán hàng trên nền tảng Shopee.</li>
<li><strong>userid</strong>: Mã user, là một người mua hàng của shop đó trên nền tảng Shopee.</li>
<li><strong>event_time</strong>: Thời điểm user đặt hàng của shop.</li>
</ul>
<p>Như vậy, một dòng dữ liệu thể hiện cho <strong>một lần user đặt hàng của một shop</strong> trên nền tảng Shopee.</p>
<h1 id=2-phân-tích-yêu-cầu>2. Phân tích yêu cầu</h1>
<p>Ý nghĩa của <strong>Order Brushing</strong>: là một kỹ thuật &ldquo;đánh bóng&rdquo; đơn hàng. Trong kỹ thuật này, người bán hàng có thể tạo ra các đơn đặt hàng giả nhằm tăng lượt tương tác, hoặc danh tiếng của người bán hoặc một mặt hàng cụ thể trong bảng xếp hạng. Mục tiêu là thăng hạng của người bán hoặc món hàng đó lên các kết quả tìm kiếm trên Shopee.</p>
<p>Mục tiêu của đề bài:</p>
<ul>
<li>Nhận diện tất cả các shop có dấu hiệu sử dụng kỹ thuật order brushing.</li>
<li>Trong các shop này, nhận diện các user có dấu hiệu thực order brushing cho shop đó.</li>
</ul>
<p>Đề bài mô tả các rule để tìm ra các đơn hàng brushing như sau:</p>
<ul>
<li>Một shop được xác định là tiến hành order brushing nếu có <strong>concentrate rate</strong> lớn hơn hoặc bằng 3:</li>
</ul>
<p>$$Concentrate\ rate = \frac{Number\ of\ Orders\ within\ 1\ hour\ of\ shopid}{Number\ of\ Unique\ Buyers\ within\ 1\ hour\ of\ a\ shop}$$</p>
<ul>
<li>Sau khi đã xác định được shop, cần xác định các user thực hiện order brushing cho shop đó. Với mỗi unique user đặt hàng shop đó, user nào có tỉ lệ <strong>user proportion</strong> cao nhất sẽ là user cần tìm. Trường hợp có nhiều user cùng tỉ lệ cao nhất thì tất cả các user đó cũng sẽ là user cần tìm.</li>
</ul>
<p>$$User\ proportion\ in\ brushing\ time = \frac{No.\ Orders\ of\ User}{No.\ Orders\ of\ Shop}$$</p>
<p>Để hiểu hơn các trường hợp cụ thể, các bạn có thể xem diễn giải tại <a href=https://www.kaggle.com/c/order-brushing-shopee-code-league/overview/examples>đây</a>.</p>
<h1 id=3-tìm-giải-pháp>3. Tìm giải pháp</h1>
<p>Load dữ liệu và xem những thuộc tính của dữ liệu:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>d1 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dirname, filename), header<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, parse_dates<span style=color:#f92672>=</span>[<span style=color:#ae81ff>3</span>])
d1<span style=color:#f92672>.</span>dtypes
</code></pre></div>
<div class="figure center">
<a class=fancybox href=https://chidokun.github.io/images/post/order-brushing/2.png title="Dữ liệu 10 dòng đầu" data-fancybox-group>
<img class=fig-img src=https://chidokun.github.io/images/post/order-brushing/2.png style=width:100% alt="Dữ liệu 10 dòng đầu">
</a>
<span class=caption>Dữ liệu 10 dòng đầu</span>
</div>
<p>Để tính <strong>concentrate rate</strong> cho từng <code>shopid</code> trong mỗi interval 1 giờ, chúng ta query dữ liệu theo điều kiện <code>shopid</code>, <code>event_time</code> và <code>end_time</code> và <code>previous_time</code> (nếu chọn <code>event_time</code> là thời điểm bắt đầu interval thì <code>end_time</code> là thời điểm kết thúc interval, ngược lại chọn <code>event_time</code> là thời điểm kết thúc thì <code>previous_time</code> sẽ là thời điểm bắt đầu) với từng đơn hàng.</p>
<p>Sau khi xác định shop có brushing, ta giữ lại tất cả các <code>orderid</code> trong khoảng thời gian <em>brushing time</em>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>delta <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Timedelta(hours<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
order_list <span style=color:#f92672>=</span> set() <span style=color:#75715e># store other rows that relevant to a brushing rows</span>
shop_query <span style=color:#f92672>=</span> dict() <span style=color:#75715e># to store query for shopid to quickly access</span>

i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
<span style=color:#66d9ef>while</span> i <span style=color:#f92672>&lt;</span> row:
    <span style=color:#75715e># if i % 10000 == 0:</span>
    <span style=color:#75715e>#     print(i)</span>

    r <span style=color:#f92672>=</span> d1<span style=color:#f92672>.</span>iloc[i]
    end_time <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>event_time <span style=color:#f92672>+</span> delta
    previous_time <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>event_time <span style=color:#f92672>-</span> delta
    
    q <span style=color:#f92672>=</span> shop_query[r<span style=color:#f92672>.</span>shopid] <span style=color:#66d9ef>if</span> r<span style=color:#f92672>.</span>shopid <span style=color:#f92672>in</span> shop_query <span style=color:#66d9ef>else</span> d1[d1<span style=color:#f92672>.</span>shopid <span style=color:#f92672>==</span> r<span style=color:#f92672>.</span>shopid]
    shop_query[r<span style=color:#f92672>.</span>shopid] <span style=color:#f92672>=</span> q

    q_n <span style=color:#f92672>=</span> q[q<span style=color:#f92672>.</span>event_time<span style=color:#f92672>.</span>between(r<span style=color:#f92672>.</span>event_time, end_time)]
    q_p <span style=color:#f92672>=</span> q[q<span style=color:#f92672>.</span>event_time<span style=color:#f92672>.</span>between(previous_time, r<span style=color:#f92672>.</span>event_time)]

    con_rate_p <span style=color:#f92672>=</span> len(q_p)<span style=color:#f92672>/</span>q_p<span style=color:#f92672>.</span>userid<span style=color:#f92672>.</span>nunique()
    con_rate_n <span style=color:#f92672>=</span> len(q_n)<span style=color:#f92672>/</span>q_n<span style=color:#f92672>.</span>userid<span style=color:#f92672>.</span>nunique()

    <span style=color:#66d9ef>if</span> con_rate_p <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span>:
        order_list<span style=color:#f92672>.</span>update(list(q_p<span style=color:#f92672>.</span>orderid<span style=color:#f92672>.</span>unique()))
    <span style=color:#66d9ef>if</span> con_rate_n <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span>:
        order_list<span style=color:#f92672>.</span>update(list(q_n<span style=color:#f92672>.</span>orderid<span style=color:#f92672>.</span>unique()))

    i<span style=color:#f92672>+=</span><span style=color:#ae81ff>1</span>
</code></pre></div><p>Khi một shop được xác định là brushing, cần phải xác định <code>userid</code> nào là brusher. Trong thời gian <em>brushing time</em> của một <code>shopid</code>, có thể có nhiều <code>userid</code> đặt hàng. Vì vậy chúng ta cần tìm user có <em>user proportion</em> cao nhất, nếu có nhiều user có cùng <em>user proportion</em> cao nhất thì phải trả về tất cả các user này.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_max</span>(userid_list, user_p_list):
    max_value <span style=color:#f92672>=</span> max(user_p_list)
    maxs_index <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>for</span> i, value <span style=color:#f92672>in</span> enumerate(user_p_list):
        <span style=color:#66d9ef>if</span> value <span style=color:#f92672>==</span> max_value:
            maxs_index<span style=color:#f92672>.</span>append(i)
    max_user <span style=color:#f92672>=</span> [ userid_list[i] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> maxs_index]
    <span style=color:#66d9ef>return</span> max_value, set(max_user)
</code></pre></div><p>Tương tự, cùng một <code>shopid</code> có thể có nhiều <em>brushing time</em> khác nhau. Mỗi <em>brushing time</em> sẽ phải tìm ra <code>userid</code> có <em>user proportion</em> cao nhất. Ta sẽ chọn <code>userid</code> có <em>user proportion</em> cao nhất trong các <code>userid</code> đã tìm được từ các <em>brushing time</em>. Nếu có nhiều <code>userid</code> có cùng <em>user proportion</em> cao nhất thì chọn tất cả.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>d2 <span style=color:#f92672>=</span> d1[d1<span style=color:#f92672>.</span>orderid<span style=color:#f92672>.</span>isin(order_list)]
shop_list <span style=color:#f92672>=</span> dict() <span style=color:#75715e># to store shopid with userids having highest user proportion</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_to_list</span>(shopid, max_tuples):
    <span style=color:#66d9ef>if</span> shopid <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> shop_list:
        shop_list[shopid] <span style=color:#f92672>=</span> max_tuples
        <span style=color:#66d9ef>return</span>
    
    max_value, max_user <span style=color:#f92672>=</span> shop_list[shopid]
    max_v, max_u <span style=color:#f92672>=</span> max_tuples
    <span style=color:#66d9ef>if</span> max_v <span style=color:#f92672>&gt;</span> max_value:
        shop_list[shopid] <span style=color:#f92672>=</span> max_tuples
    <span style=color:#66d9ef>elif</span> max_v <span style=color:#f92672>==</span> max_value:
        shop_list[shopid] <span style=color:#f92672>=</span> (max_value, max_user<span style=color:#f92672>.</span>union(max_u))

<span style=color:#75715e># Process brushing order set</span>
d2_uniq_shop <span style=color:#f92672>=</span> d2<span style=color:#f92672>.</span>shopid<span style=color:#f92672>.</span>unique()
<span style=color:#66d9ef>for</span> shopid <span style=color:#f92672>in</span> d2_uniq_shop:
    q <span style=color:#f92672>=</span> d2[d2<span style=color:#f92672>.</span>shopid <span style=color:#f92672>==</span> shopid]

    user_list <span style=color:#f92672>=</span> q<span style=color:#f92672>.</span>userid<span style=color:#f92672>.</span>unique()
    sum_order <span style=color:#f92672>=</span> len(q)
    user_proportion <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>for</span> userid <span style=color:#f92672>in</span> user_list:
        user_proportion<span style=color:#f92672>.</span>append(len(q[q<span style=color:#f92672>.</span>userid <span style=color:#f92672>==</span> userid])<span style=color:#f92672>/</span>sum_order)

    max_value, max_user <span style=color:#f92672>=</span> find_max(user_list,user_proportion)
    add_to_list(shopid, (max_value, max_user))

</code></pre></div><p>Sau khi có tất cả các <code>shopid</code> và <code>userid</code> cần tìm, chúng ta sẽ ghi file để làm submission.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Get unique shopid</span>
unique_shopid <span style=color:#f92672>=</span> d1<span style=color:#f92672>.</span>shopid<span style=color:#f92672>.</span>unique()

<span style=color:#75715e># Format userid for each shopid</span>
userid_shopid <span style=color:#f92672>=</span> []
<span style=color:#66d9ef>for</span> shopid <span style=color:#f92672>in</span> unique_shopid:
    userid <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>
    <span style=color:#66d9ef>if</span> shopid <span style=color:#f92672>in</span> shop_list:
        max_value, max_user <span style=color:#f92672>=</span> shop_list[shopid]
        userid <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&amp;&#34;</span><span style=color:#f92672>.</span>join([str(u) <span style=color:#66d9ef>for</span> u <span style=color:#f92672>in</span> sorted(list(max_user))])
    userid_shopid<span style=color:#f92672>.</span>append(userid)

</code></pre></div><p>Cuối cùng là ghi file và nộp.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>sms <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({
    <span style=color:#e6db74>&#34;shopid&#34;</span>: unique_shopid,
    <span style=color:#e6db74>&#34;userid&#34;</span>: userid_shopid
})
sms<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#34;/kaggle/working/submission.csv&#34;</span>, index<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</code></pre></div>
<div class="figure center">
<a class=fancybox href=https://chidokun.github.io/images/post/order-brushing/3.png title="Kết quả dự đoán sắp xếp descending theo userid" data-fancybox-group>
<img class=fig-img src=https://chidokun.github.io/images/post/order-brushing/3.png style=width:70% alt="Kết quả dự đoán sắp xếp descending theo userid">
</a>
<span class=caption>Kết quả dự đoán sắp xếp descending theo userid</span>
</div>
<p>Các bạn có thể xem toàn bộ notebook, dữ liệu tại GitHub hoặc Notebook của nhóm trên Kaggle.</p>
<ul>
<li>GitHub: <a href=https://github.com/chidokun/order-brushing-shopee-code-league>order-brushing-shopee-code-league</a></li>
<li>Kaggle: <a href=https://www.kaggle.com/nguyentuanit96/order-brushing-solution-shopee-code-league-2020>Order Brushing Solution (Shopee Code League 2020)</a></li>
</ul>
<h1 id=4-nhận-định>4. Nhận định</h1>
<p>Trong quá trình giải quyết problem, team cũng đã tìm ra một vài điểm không hợp lý trong bộ rule được mô tả và cũng có người nhận ra điều đó:</p>
<ul>
<li><a href=https://www.kaggle.com/c/order-brushing-shopee-code-league/discussion/158078>Calculating Highest Proportion</a></li>
</ul>
<div class="figure center">
<a class=fancybox href=https://chidokun.github.io/images/post/order-brushing/4.png title="Đây là sân chơi của anh và mấy chú phải nghe anh :D" data-fancybox-group>
<img class=fig-img src=https://chidokun.github.io/images/post/order-brushing/4.png style=width:100% alt="Đây là sân chơi của anh và mấy chú phải nghe anh :D">
</a>
<span class=caption>Đây là sân chơi của anh và mấy chú phải nghe anh :D</span>
</div>
<p>Câu trả lời của Shopee đơn giản là <em>&ldquo;đây là sân chơi của anh và mấy chú phải nghe anh&rdquo;</em> :D. Dễ hiểu, cuộc thi là cuộc thi, các rule đưa ra chỉ để phục vụ cuộc thi mà thôi. Nếu đưa ra một bộ rule hoàn chỉnh thì có thể bọn order brushing sẽ biết mà lách luật :D</p>
<p>Cảm ơn đồng đội đã cùng mình chiến hết sức.</p>
<p>Many thanks for my teammate <strong><a href=https://github.com/hoanghouit>@hoanghouit</a></strong> (Business Analyst), <strong><a href=https://github.com/XuanVuong>@XuanVuong</a></strong> (Business Analyst), <strong><a href=https://github.com/PhamVanMinh272>@PhamVanMinh272</a></strong> (Data Engineer).</p>
</div>
</div>
<div id=post-footer class="post-footer main-content-wrap">
<div class=post-footer-tags>
<span class="text-color-light text-small">THẺ ĐÁNH DẤU</span><br>
<a class="tag tag--primary tag--small" href=https://chidokun.github.io/tags/data/>data</a>
<a class="tag tag--primary tag--small" href=https://chidokun.github.io/tags/python/>python</a>
<a class="tag tag--primary tag--small" href=https://chidokun.github.io/tags/programming/>programming</a>
</div>
<div class=post-actions-wrap>
<nav>
<ul class="post-actions post-action-nav">
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://chidokun.github.io/2020/07/logistics-problem/ data-tooltip="Logistics Problem (Shopee Code League 2020)">
<i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">Tiếp</span>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://chidokun.github.io/2020/05/crawl-tiki-products/ data-tooltip="Tập tành crawl dữ liệu product của Tiki">
<span class="hide-xs hide-sm text-small icon-mr">Trước</span>
<i class="fa fa-angle-right"></i>
</a>
</li>
</ul>
</nav>
<ul class="post-actions post-action-share">
<li class="post-action hide-lg hide-md hide-sm">
<a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions>
<i class="fa fa-share-alt"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-facebook-official"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-twitter"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://plus.google.com/share?url=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-google-plus"></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#disqus_thread>
<i class="fa fa-comment-o"></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#>
<i class="fa fa-list"></i>
</a>
</li>
</ul>
</div>
<div id=fb-root></div>
<script>(function(b,c,d){var a,e=b.getElementsByTagName(c)[0];if(b.getElementById(d))return;a=b.createElement(c),a.id=d,a.src='https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v3.1&appId=445006706177461&autoLogAppEvents=1',e.parentNode.insertBefore(a,e)})(document,'script','facebook-jssdk')</script>
<div id=fb-cmt-thread class=fb-comments data-href=https://chidokun.github.io/2020/06/order-brushing/ data-width=100%></div>
</div>
</article>
<footer id=footer class=main-content-wrap>
<span class=copyrights>
&copy; 2021 <a href=https://github.com/chidokun>Nguyễn Tuấn</a>. All Rights Reserved
</span>
</footer>
</div>
<div id=bottom-bar class=post-bottom-bar data-behavior=5>
<div class=post-actions-wrap>
<nav>
<ul class="post-actions post-action-nav">
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://chidokun.github.io/2020/07/logistics-problem/ data-tooltip="Logistics Problem (Shopee Code League 2020)">
<i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">Tiếp</span>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://chidokun.github.io/2020/05/crawl-tiki-products/ data-tooltip="Tập tành crawl dữ liệu product của Tiki">
<span class="hide-xs hide-sm text-small icon-mr">Trước</span>
<i class="fa fa-angle-right"></i>
</a>
</li>
</ul>
</nav>
<ul class="post-actions post-action-share">
<li class="post-action hide-lg hide-md hide-sm">
<a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions>
<i class="fa fa-share-alt"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-facebook-official"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-twitter"></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://plus.google.com/share?url=https://chidokun.github.io/2020/06/order-brushing/">
<i class="fa fa-google-plus"></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#disqus_thread>
<i class="fa fa-comment-o"></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#>
<i class="fa fa-list"></i>
</a>
</li>
</ul>
</div>
</div>
<div id=share-options-bar class=share-options-bar data-behavior=5>
<i id=btn-close-shareoptions class="fa fa-close"></i>
<ul class=share-options>
<li class=share-option>
<a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fchidokun.github.io%2F2020%2F06%2Forder-brushing%2F">
<i class="fa fa-facebook-official"></i><span>Chia sẻ với Facebook</span>
</a>
</li>
<li class=share-option>
<a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fchidokun.github.io%2F2020%2F06%2Forder-brushing%2F">
<i class="fa fa-twitter"></i><span>Chia sẻ với Twitter</span>
</a>
</li>
<li class=share-option>
<a class=share-option-btn target=new href="https://plus.google.com/share?url=https%3A%2F%2Fchidokun.github.io%2F2020%2F06%2Forder-brushing%2F">
<i class="fa fa-google-plus"></i><span>Chia sẻ với Google+</span>
</a>
</li>
</ul>
</div>
<div id=share-options-mask class=share-options-mask></div>
</div>
<div id=about>
<div id=about-card>
<div id=about-btn-close>
<i class="fa fa-remove"></i>
</div>
<img id=about-card-picture src="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=110" alt="Ảnh đại diện">
<h4 id=about-card-name>Nguyễn Tuấn</h4>
<div id=about-card-bio>A guy with passionate at the code</div>
<div id=about-card-job>
<i class="fa fa-briefcase"></i>
<br>
Software Engineer
</div>
<div id=about-card-location>
<i class="fa fa-map-marker"></i>
<br>
Saigon, Vietnam
</div>
</div>
</div>
<div id=cover style=background-image:url(https://chidokun.github.io/images/background.jpg)></div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin=anonymous></script>
<script src=https://chidokun.github.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js></script>
<script crossorigin=anonymous integrity=sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js></script>
<script crossorigin=anonymous integrity=sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js></script>
<script src=https://chidokun.github.io/js/main.js></script>
<script lang=javascript>window.onload=updateMinWidth,window.onresize=updateMinWidth,document.getElementById("sidebar").addEventListener("transitionend",updateMinWidth);function updateMinWidth(){var b=document.getElementById("sidebar"),a=document.getElementById("main"),c,d,e;a.style.minWidth="",c=getComputedStyle(a).getPropertyValue("min-width"),d=getComputedStyle(b).getPropertyValue("width"),e=getComputedStyle(b).getPropertyValue("left"),a.style.minWidth=`calc(${c} - ${d} - ${e})`}</script>
<script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:!1}),$('pre.code-highlight > code, pre > code').each(function(b,a){$(this).hasClass('codeblock')||$(this).addClass('codeblock'),hljs.highlightBlock(a)})})</script>
<script>var disqus_config=function(){this.page.url='https://chidokun.github.io/2020/06/order-brushing/',this.page.identifier='/2020/06/order-brushing/'};(function(){var a,b,c;if(window.location.hostname=="localhost")return;a=document,b=a.createElement('script'),c='nguyentuanit96',b.src='//'+c+'.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
  <head>
    
    <script type="application/ld+json">

{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MIME Type and Uploaded File Type Detection Problem",
  
  "image": "https://chidokun.github.io/thumbnails/mime.png",
  
  "datePublished": "2021-10-13T22:54:00+07:00",
  "dateModified": "2021-10-13T22:54:00+07:00",
  "author": {
    "@type": "Person",
    "name": "Nguyễn Tuấn",
    
    "image": "https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50"
    
  },
  "mainEntityOfPage": { 
    "@type": "WebPage",
    "@id": "https:\/\/chidokun.github.io\/2021\/10\/mime-type-and-upload-file-problem\/en\/" 
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nguyễn Tuấn's Blog",
    
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50"
    }
    
  },
  "description": "The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.",
  "keywords": ["mime type, file type, mime type detection, upload", "development, programming, chidokun, lập trình"]
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.87.0 with theme Tranquilpeak 0.5.0-BETA">
<meta name="author" content="Nguyễn Tuấn">
<meta name="keywords" content="mime type, file type, mime type detection, upload, development, programming, chidokun, lập trình">
<meta name="description" content="The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.">


<meta property="og:description" content="The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.">
<meta property="og:type" content="article">
<meta property="og:title" content="MIME Type and Uploaded File Type Detection Problem">
<meta name="twitter:title" content="MIME Type and Uploaded File Type Detection Problem">
<meta property="og:url" content="https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/">
<meta property="twitter:url" content="https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/">
<meta property="og:site_name" content="Nguyễn Tuấn&#39;s Blog">
<meta property="og:description" content="The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.">
<meta name="twitter:description" content="The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.">
<meta property="og:locale" content="vi">

  
    <meta property="article:published_time" content="2021-10-13T22:54:00">
  
  
    <meta property="article:modified_time" content="2021-10-13T22:54:00">
  
  
  
    
      <meta property="article:section" content="Lập trình">
    
      <meta property="article:section" content="Backend">
    
  
  
    
      <meta property="article:tag" content="backend">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=640">





  <meta property="og:image" content="https://chidokun.github.io/thumbnails/mime.png">
  <meta property="twitter:image" content="https://chidokun.github.io/thumbnails/mime.png">


    <title>MIME Type and Uploaded File Type Detection Problem</title>

    <link rel="icon" href="https://chidokun.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://chidokun.github.io/css/style-x4v5aep1xln8tw4u8b4utrzzm45rcnnq6emr4myqn5eka2yri56y1t7q.min.css" />
    
    
      
        <link rel="stylesheet"  crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei">
      
    
      
        <link rel="stylesheet"  href="https://chidokun.github.io/styles/styles.css">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-64965138-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    <meta name="google-site-verification" content="MgXdDXZwDhcwwTzczA6YhQBynidGFAQUBd7PKu2ubfI" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,700;1,900&subset=cyrillic,cyrillic-ext,latin-ext&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://chidokun.github.io/" aria-label="Tới trang chủ">Nguyễn Tuấn&#39;s Blog</a>
  </div>
  
    
      <a class="header-right-icon st-search-show-outputs"
         href="https://chidokun.github.io/#search" aria-label="Mở liên kết: /#search">
    
    
      <i class="fa fa-lg fa-search"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://chidokun.github.io/#about" aria-label="Tìm hiểu thêm về tác giả">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=110" alt="Ảnh đại diện" />
        </a>
        <h4 class="sidebar-profile-name">Nguyễn Tuấn</h4>
        
          <h5 class="sidebar-profile-bio">A guy with passionate at the code</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Trang chủ</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/categories/l%E1%BA%ADp-tr%C3%ACnh/" title="Lập trình">
    
      <i class="sidebar-button-icon far fa-lg fa-code" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Lập trình</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/categories/d%E1%BB%AF-li%E1%BB%87u/" title="Dữ liệu">
    
      <i class="sidebar-button-icon fa fa-lg fa-database" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Dữ liệu</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/categories/cu%E1%BB%99c-s%E1%BB%91ng/" title="Cuộc sống">
    
      <i class="sidebar-button-icon fab fa-lg fa-pagelines" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Cuộc sống</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Danh mục</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Thẻ thông tin</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Lưu trữ</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Thông tin</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/chidokun" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://chidokun.github.io/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      MIME Type and Uploaded File Type Detection Problem
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-10-13T22:54:00&#43;07:00">
        
  
  
  
  
    13 tháng 10 2021
  

      </time>
    
    
  
  
    <span>mục</span>
    
      <a class="category-link" href="https://chidokun.github.io/categories/l%e1%ba%adp-tr%c3%acnh">Lập trình</a>, 
    
      <a class="category-link" href="https://chidokun.github.io/categories/backend">Backend</a>
    
  

  </div>

  <div>
  <div class="fb-like" 
    data-href="https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/" 
    data-width="" 
    data-layout="button_count" 
    data-action="like" 
    data-size="large" 
    data-share="false"></div>
</div>
</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <h1 id="table-of-contents">Mục lục</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#beginning">Beginning</a></li>
    <li><a href="#lets-go">Let&rsquo;s go!</a></li>
    <li><a href="#file-type-determination-on-the-backend">File type determination on the backend</a>
      <ul>
        <li><a href="#using-the-mime-type-defined-by-the-user-agent">Using the MIME Type defined by the User-agent</a></li>
        <li><a href="#mime-type-and-some-ways-to-determine-file-type">MIME Type and some ways to determine file type</a></li>
        <li><a href="#using-apache-tika-to-determine-mime-type">Using Apache Tika to determine MIME Type</a></li>
      </ul>
    </li>
    <li><a href="#tldr">TL;DR</a></li>
  </ul>
</nav>

<h1 id="beginning">Beginning</h1>
<p>The story begins in my previous projects. There was a requirement to develop a feature that an administrator can upload a text file containing bad words. The system used these words to real-time check the contents that the user submitted. The uploaded file needs to follow a specific format.</p>
<p>To prevent users from uploading files other than text files, we can do it on the frontend.</p>
<pre><code class="language-html">&lt;input type=&quot;file&quot; accept=&quot;text/plain&quot; /&gt;
</code></pre>
<p>So that user merely selects a text file in the file selection window.</p>
<p>However, to ensure system security, just blocking the user on the interface is not enough. It is necessary to re-verify the uploaded file on the backend to see if the user has uploaded a text file or not.. <em><span class="highlight-text green">The problem we need to solve is to determine the actual type of file uploaded by the user.</span></em>.</p>
<h1 id="lets-go">Let&rsquo;s go!</h1>
<p>To illustrate the above problem, we will build a demo system with a frontend using React.js and a backend using Java/Spring Boot.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/1.png" data-fancybox-group="">
  
    <img class="fig-img" src="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/1.png" style="width: 80%;">
  
    </a>
  
  
</div>

<p>Our interface is quite simple, consisting of an <code>input[type=file]</code> and a <code>button</code> to upload the selected file. When selecting a file, the UI will display the MIME Type that the browser determines. After uploading the file, the system will return the MIME type identified by the backend. All sourcecode is <a href="https://github.com/chidokun/mime-type-upload-example">here</a>.</p>
<p>Also, prepare some files to test whether the system determines correctly or not.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/2.png" data-fancybox-group="">
  
    <img class="fig-img" src="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/2.png" style="width: 100%;">
  
    </a>
  
  
</div>

<p>Prepare 3 files with the correct extension, then copy these files and rename them:</p>
<ul>
<li>real.png -&gt; fake.txt</li>
<li>real.jpg -&gt; fake.zip</li>
<li>real.svg -&gt; fake.docx</li>
</ul>
<h1 id="file-type-determination-on-the-backend">File type determination on the backend</h1>
<p>The backend system in the project is written in Java using Spring Boot. A controller is implemented to receive the upload request from the user as well.</p>

  
    
  
  
    
  
  
  


<figure class="highlight java language-java">
  <figcaption>
    
      <span>UploadController.java</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-java java"><code class="java">@Slf4j
@RestController
public class UploadController {

    @PostMapping(path = &#34;/check-file-type&#34;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public ResponseEntity&lt;Response&gt; checkFileType(@RequestPart MultipartFile file) {
        // to be implemented
    }
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<p>And a <code>Response</code> to return the result to the user.</p>

  
    
  
  
    
  
  
  


<figure class="highlight java language-java">
  <figcaption>
    
      <span>Response.java</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-java java"><code class="java">@Data
@NoArgsConstructor
@AllArgsConstructor
public class Response {
    private int status;
    private String message;
    private String mimeType;

    public Response(String mimeType) {
        this.status = HttpStatus.OK.value();
        this.message = &#34;Successful&#34;;
        this.mimeType = mimeType;
    }
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<h2 id="using-the-mime-type-defined-by-the-user-agent">Using the MIME Type defined by the User-agent</h2>
<p>When selecting a file from <code>input[type=file]</code>, the file type is already determined by the browser (user-agent) follow MIME type format and then transmitted to the backend via the <code>Content-Type</code> request header. So the <code>MultipartFile</code> class in the controller&rsquo;s parameter already has information about the file&rsquo;s type.</p>
<p>Now you can use <code>getContentType()</code> to determine the file type based on the MIME Type.</p>
<pre><code class="language-java">@PostMapping(path = &quot;/check-file-type&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
public ResponseEntity&lt;Response&gt; checkFileType(@RequestPart MultipartFile file) {
    String mimeType = file.getContentType();
    return ResponseEntity.ok(new Response(mimeType));
}
</code></pre>
<p>Let&rsquo;s test the files we prepared above.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/3.png" title="Test results with real.png and fake.zip" data-fancybox-group="">
  
    <img class="fig-img" src="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/3.png" style="width: 100%;" alt="Test results with real.png and fake.zip">
  
    </a>
  
   
    <span class="caption">Test results with real.png and fake.zip</span>
  
</div>

<p>In the case of the file <code>real.png</code>, the user-agent identified the correct MIME type via the <code>.png</code> extension. But with the file <code>fake.zip</code>, the user-agent cannot correctly identify its file type as JPG but determines it through the <code>.zip</code> extension. Therefore, relying on a client-defined MIME type may have some risks when users intentionally change the file&rsquo;s name and extension.</p>
<p>Each file type has different specifications and is stored differently, so if you want to determine the exact type of the file, you need to read the contents of that file.</p>
<h2 id="mime-type-and-some-ways-to-determine-file-type">MIME Type and some ways to determine file type</h2>
<p><strong>MIME type</strong> (<em>Multipurpose Internet Mail Extensions</em>) is a standard that defines the nature and format of a document, file, or set of bytes. It is defined and standardized in IETF&rsquo;s <a href="https://datatracker.ietf.org/doc/html/rfc6838">RFC 6838</a>.</p>
<p>The structure of the MIME type includes <em>type</em> and <em>subtype</em>:</p>
<pre><code>type/subtype
</code></pre>
<p><em>Example</em>: <code>text/plain</code>, <code>application/zip</code>, &hellip;</p>
<p>Trong đó:</p>
<ul>
<li><strong>Type</strong> is the general category to which the data type belongs, such as <code>video</code> or <code>text</code>.</li>
<li><strong>Subtype</strong> determines the exact data type classified. For example: With type <code>text</code>, we can have subtypes like <code>plain</code> (plain text), <code>html</code> (HTML source code), or <code>calendar</code> (iCalendar <code>.ics</code> format).</li>
</ul>
<p>In general, <em><span class="highlight-text green">MIME Type is a name assigned to a file type and is used to determine what type of content to transmit data and the applications based on it to behave accordingly</span></em>. From the MIME type, we can determine the file type, so <em><span class="highlight-text red">from a file how to identify its MIME type?</span></em></p>
<p>To determine the MIME type, we need to read its contents. Each file type will have a different storage method, such as a ZIP file with a file specification like <a href="https://www.iana.org/assignments/media-types/application/zip">here</a>. But there are still some common features that can be used for identification.</p>
<p><strong>File Signature</strong> are pattern bytes stored at the beginning of the file (also known as <em>magic number</em> or <em>magic bytes</em>), used to identify the content and format of the file. The table below lists some File signatures of some popular formats (see some file signatures <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">here</a>).</p>
<table>
<thead>
<tr>
<th>Hex signature</th>
<th>ISO 8859-1</th>
<th>Offset</th>
<th>Extension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>89 50 4E 47 0D 0A 1A 0A</code></td>
<td><code>‰PNG␍␊␚␊</code></td>
<td>0</td>
<td>png</td>
<td>Image encoded in the Portable Network Graphics format</td>
</tr>
<tr>
<td><code>EF BB BF</code></td>
<td><code>ï»¿</code></td>
<td>0</td>
<td>txt</td>
<td>UTF-8 byte order mark, commonly seen in text files.</td>
</tr>
<tr>
<td><code>25 50 44 46 2D</code></td>
<td><code>%PDF-</code></td>
<td>0</td>
<td>pdf</td>
<td>PDF document</td>
</tr>
<tr>
<td><code>66 74 79 70 69 73 6F 6D</code></td>
<td><code>ftypisom</code></td>
<td>4</td>
<td>mp4</td>
<td>ISO Base Media file (MPEG-4)</td>
</tr>
<tr>
<td><code>37 7A BC AF 27 1C</code></td>
<td>`7z¼¯'␜</td>
<td>0</td>
<td>7z</td>
<td>7-Zip File Format</td>
</tr>
</tbody>
</table>
<p>Besides using the <em>File signature</em>, sometimes it&rsquo;s necessary to read file content to find the exact file type. For example, SVG format is essentially XML. Therefore, to determine it, in addition to having to read <em>magic number</em> to determine the XML format, it is also necessary to read more content inside to determine the SVG format correctly.</p>
<p>Some other formats, such as <em>Apple iWork</em>, are actually a collection of XML files inside a Zip file. At this time, the Zip file is responsible for making the container containing the XML files. File type identification becomes more difficult due to the need to decompress the content inside.</p>
<h2 id="using-apache-tika-to-determine-mime-type">Using Apache Tika to determine MIME Type</h2>
<p>With Java systems, <a href="https://tika.apache.org/">Apache Tika</a> can be used to extract information and determine the exact format of the file&rsquo;s data. Apache Tika finds out the data format of a file based on several criteria:</p>
<ul>
<li><em>Magic number</em>: Set of first bytes of the file.</li>
<li><em>File name extension</em>: Partially based on file extension.</li>
<li><em>Metadata</em> of files downloaded from the Internet.</li>
<li>Define <em>container</em> and its contents.</li>
</ul>
<p>To use Tika in a <em>Maven project</em>, you can add a dependency to <code>pom.xml</code>:</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.tika&lt;/groupId&gt;
    &lt;artifactId&gt;tika-core&lt;/artifactId&gt;
    &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>So we can write more functions that determine the correct MIME type of a file when uploading to the system.</p>

  
    
  
  
    
  
  
  


<figure class="highlight java language-java">
  <figcaption>
    
      <span>FileUtils.java</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-java java"><code class="java">public class FileUtils {
    public static String getRealMimeType(MultipartFile file) {
        AutoDetectParser parser = new AutoDetectParser();
        Detector detector = parser.getDetector();
        try {
            Metadata metadata = new Metadata();
            TikaInputStream stream = TikaInputStream.get(file.getInputStream());
            MediaType mediaType = detector.detect(stream, metadata);
            return mediaType.toString();
        } catch (IOException e) {
            return MimeTypes.OCTET_STREAM;
        }
    }
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<p>Create one more API under the backend and use Tika to recognize the MIME Type.</p>
<pre><code class="language-java">@PostMapping(path = &quot;/check-real-type&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
public ResponseEntity&lt;Response&gt; checkRealType(@RequestPart MultipartFile file) {
    String mimeType = FileUtils.getRealMimeType(file);
    return ResponseEntity.ok(new Response(mimeType));
}
</code></pre>
<p>After that, edit the UI to upload files to the backend using the newly created API and test again with some files.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/4.png" title="Test results with real.png and fake.zip. Tika got it right." data-fancybox-group="">
  
    <img class="fig-img" src="https://chidokun.github.io/images/post/software/mime-type-and-upload-file-problem/4.png" style="width: 100%;" alt="Test results with real.png and fake.zip. Tika got it right.">
  
    </a>
  
   
    <span class="caption">Test results with real.png and fake.zip. Tika got it right.</span>
  
</div>

<p>In the file <code>real.png</code> Tika identified the correct MIME type. With the file <code>fake.zip</code>, Tika correctly identified the original MIME type of the file as <code>image/jpeg</code> despite being renamed <code>fake.zip</code>.</p>
<p>The list of formats that Tika is supporting can be found<a href="https://tika.apache.org/2.1.0/formats.html">here</a>.</p>
<h1 id="tldr">TL;DR</h1>
<p>Backend systems should verify the type of the uploaded file when receiving an uploaded file. Checking the file type based on the MIME type detected by the browser may not be sufficient because there will be some cases where the file is changed to an extension to phishing the system. Each file type has a different structure. It&rsquo;s possible to determine the exact type of a file based on its format with the help of Apache Tika on Java systems.</p>
<p>See the source code here: <a href="https://github.com/chidokun/mime-type-upload-example">https://github.com/chidokun/mime-type-upload-example</a></p>
<p><strong>References</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME types (IANA media types)</a></li>
<li><a href="https://www.w3.org/TR/html401/interact/forms.html#h-17.13.4">Form Content-Type</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_file_signatures">List of file signatures</a></li>
<li><a href="https://tika.apache.org/2.0.0/detection.html">Apache Tika - Content Detection</a></li>
</ul>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">THẺ ĐÁNH DẤU</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://chidokun.github.io/tags/backend/">backend</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">Tiếp</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://chidokun.github.io/2021/09/mime-type-and-upload-file-problem/" data-tooltip="Bàn về MIME Type và Bài toán Nhận dạng File type khi upload" aria-label="Trước: Bàn về MIME Type và Bài toán Nhận dạng File type khi upload">
              
                  <span class="hide-xs hide-sm text-small icon-mr">Trước</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Chia sẻ bài viết này">
            <i class="fa fa-share-alt" aria-hidden="true"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/" title="Chia sẻ với %s Facebook" aria-label="Chia sẻ với %s Facebook">
              <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/" title="Chia sẻ với %s Twitter" aria-label="Chia sẻ với %s Twitter">
              <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#" aria-label="Trở lại đầu trang">
        
          <i class="fa fa-list" aria-hidden="true"></i>
        </a>
      </li>
    </ul>
  
</div>

            
  
    <section id="comments">
        
        <h2 class="title"><a href="#comments">Bình luận</a></h2>
        <form id="comment-form" class="post-new-comment" method="post" action="https://chidokun-blog-comment.herokuapp.com/v3/entry/github/chidokun/chidokun.github.io/master/comments">
            
            
            <div class="comment-box">
                <textarea name="fields[comment]" class="comment-input-control comment-input-animated" placeholder="Comment (markdown is accepted) *" required rows="3"></textarea>
                <div class="comment-box-tail">
                    <input type="hidden" name="options[redirect]" value="https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/#comment-submitted">
                    <input type="hidden" name="options[slug]" value="mime-type-and-upload-file-problem.en-us">
                    <input type="text" name="fields[name]" class="post-comment-field" placeholder="Name *" required/>
                    <input type="email" name="fields[email]" class="post-comment-field" placeholder="Email address (will not be public) *" required/>
                    <input type="hidden" id="comment-parent" name="fields[reply_to]" value="">
                    <input type="submit" class="btn btn--primary comment-buttons btn--comment" value="BÌNH LUẬN">
                </div>
            </div>
            
            
        </form>
        <section class="staticman-comments post-comments">
            
            
            
    
            
            
    
            
    
            
    
        </section>

    <div id="comment-submitted" class="dialog">
        <h3>Cảm ơn bạn</h3>
        <p>Your comment has been submitted and will be published once it has been approved. &#128522;</p>

        <p><a href="#" class="btn btn--primary comment-buttons ok">OK</a></p>
    </div>

    
</section>

  
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 <a href="https://github.com/chidokun">Nguyễn Tuấn</a>. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">Tiếp</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://chidokun.github.io/2021/09/mime-type-and-upload-file-problem/" data-tooltip="Bàn về MIME Type và Bài toán Nhận dạng File type khi upload" aria-label="Trước: Bàn về MIME Type và Bài toán Nhận dạng File type khi upload">
              
                  <span class="hide-xs hide-sm text-small icon-mr">Trước</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Chia sẻ bài viết này">
            <i class="fa fa-share-alt" aria-hidden="true"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/" title="Chia sẻ với %s Facebook" aria-label="Chia sẻ với %s Facebook">
              <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://chidokun.github.io/2021/10/mime-type-and-upload-file-problem/en/" title="Chia sẻ với %s Twitter" aria-label="Chia sẻ với %s Twitter">
              <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#" aria-label="Trở lại đầu trang">
        
          <i class="fa fa-list" aria-hidden="true"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fchidokun.github.io%2F2021%2F10%2Fmime-type-and-upload-file-problem%2Fen%2F" aria-label="Chia sẻ với %s Facebook">
          <i class="fab fa-facebook" aria-hidden="true"></i><span>Chia sẻ với Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fchidokun.github.io%2F2021%2F10%2Fmime-type-and-upload-file-problem%2Fen%2F" aria-label="Chia sẻ với %s Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Chia sẻ với Twitter</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/e09926cb6ae66048297c59c891a02e50?s=110" alt="Ảnh đại diện" />
    
    <h4 id="about-card-name">Nguyễn Tuấn</h4>
    
      <div id="about-card-bio">A guy with passionate at the code</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        Saigon, Vietnam
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://chidokun.github.io/images/background.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://chidokun.github.io/js/script-8lglxdix2nqhalxxm2bujhkcc8cctdrd5o5axonwhfzx2zqrer5facyn8.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  

  
    <script crossorigin="anonymous" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
  

  
    <script crossorigin="anonymous" integrity="sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc" src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js"></script>
  

  
    <script src="https://chidokun.github.io/js/main.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

